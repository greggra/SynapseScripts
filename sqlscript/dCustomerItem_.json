{
	"name": "dCustomerItem_",
	"properties": {
		"folder": {
			"name": "LCoA"
		},
		"content": {
			"query": "use dynamics365_financeandoperations_d365techdelivery_dev_sandbox\ngo\n\nif (Object_Id('stoneridge.dCustomerItem') is not null) \n   drop view stoneridge.dCustomerItem\ngo\n\ncreate view stoneridge.dCustomerItem as\n  select cvei.CustVendRelation as [Account Number]\n        ,cvei.ItemId as [Item Id]\n        ,cvei.ExternalItemId as [External Item Id]\n        ,cvei.DataAreaId -- optional, comment out if only one company\n    from CustVendExternalItem cvei\n   where cvei.ModuleType = 4 -- ModuleInventPurchSalesVendCustGroup::Cust\n/* Test\nselect top 100 * from stoneridge.dCustomerItem\nselect 'stoneridge.dCustomerItem', count(*) as NumberOfRows from stoneridge.dCustomerItem union\nselect 'CustVendExternalItem', count(*) from CustVendExternalItem where ModuleType = 4\n*/\ngo\n\n\nselect AccountCode, count(*) from PriceDiscTable group by AccountCode\nselect top 100 * from PriceDiscTable where AccountCode = 0 -- PriceDiscPartyCodeType::Table\nselect top 100 * from PriceDiscTable where AccountCode = 1 -- PriceDiscPartyCodeType::Group\nselect top 100 * from PriceDiscTable where AccountCode = 2 -- PriceDiscPartyCodeType::All\n\nselect Relation, count(*) from PriceDiscTable group by Relation\nselect top 100 * from PriceDiscTable where Relation = 0 -- PriceType::PricePurch\nselect top 100 * from PriceDiscTable where Relation = 4 -- PriceType::PriceSales\nselect top 100 * from PriceDiscTable where Relation = 5 -- PriceType::LineDiscSales\n\nselect ItemCode, count(*) from PriceDiscTable group by ItemCode\nselect top 100 * from PriceDiscTable where ItemCode = 0 -- PriceDiscProductCode::Table\nselect top 100 * from PriceDiscTable where ItemCode = 2 -- PriceDiscProductCode::All\n\n\nselect AccountCode, Relation, ItemCode, count(*) \n  from PriceDiscTable \n where DataAreaId = 'DUS'\n   and Relation <> 0 -- PriceType::PricePurch\n   and cast(getdate() as date) between FromDate \n                                   and case when ToDate = cast('1/1/1900' as datetime) then cast('1/1/2100' as datetime) else ToDate end\n group by AccountCode, Relation, ItemCode\n order by 1, 2, 3\n\nselect top 100 AccountCode, Relation, ItemCode, AccountRelation, ItemRelation, Amount, Percent1, *\n  from PriceDiscTable \n where DataAreaId = 'DUS'\n   and Relation <> 0 -- PriceType::PricePurch\n   and cast(getdate() as date) between FromDate \n                                   and case when ToDate = cast('1/1/1900' as datetime) then cast('1/1/2100' as datetime) else ToDate end\n order by 1, 2, 3\n\nselect top 100\n       1 as ApplicationOrder\n      ,pdt.AccountRelation as [Account Number]\n      ,pdt.ItemRelation as [Item Id]\n      ,pdt.Amount * (1 - pdt.Percent1/100) as [Customer Price]\n  from PriceDiscTable pdt\n where pdt.DataAreaId = 'DUS'\n   and pdt.Relation = 5    -- Apply discount percent\n   and pdt.AccountCode = 0 -- Specific customer\n   and pdt.ItemCode = 0    -- Specific item\n   and cast(getdate() as date) between pdt.FromDate \n                                   and case when pdt.ToDate = cast('1/1/1900' as datetime) then cast('1/1/2100' as datetime) else pdt.ToDate end\n\nselect count(*) from PriceDiscTable pdt\n where cast(getdate() as date) between pdt.FromDate \n                                   and case when pdt.ToDate = cast('1/1/1900' as datetime) then cast('1/1/2100' as datetime) else pdt.ToDate end\nselect top 100\n       2 as ApplicationOrder\n      ,ct.AccountNum as [Account Number]\n      ,pdt.ItemRelation as [Item Id]\n      ,pdt.Amount as [Customer Price]\n  from PriceDiscTable pdt\n         inner join CustTable ct on ct.PriceGroup = pdt.AccountRelation and ct.DataAreaId = pdt.DataAreaId\n where pdt.DataAreaId = 'DUS'\n   and pdt.Relation = 4    -- Use specified price\n   and pdt.AccountCode = 1 -- For a customer group\n   and pdt.ItemCode = 0    -- For a specified item\n   and cast(getdate() as date) between pdt.FromDate \n                                   and case when pdt.ToDate = cast('1/1/1900' as datetime) then cast('1/1/2100' as datetime) else pdt.ToDate end\n\nselect top 100\n       3 as ApplicationOrder\n      ,ct.AccountNum as [Account Number]\n      ,it.ItemId as [Item Id]\n      ,pdt.Amount as [Customer Price]\n  from PriceDiscTable pdt\n         inner join CustTable ct on ct.PriceGroup = pdt.AccountRelation and ct.DataAreaId = pdt.DataAreaId\n         inner join InventTable it on it.DataAreaId = pdt.DataAreaId\n where pdt.DataAreaId = 'DUS'\n   and pdt.Relation = 5    -- Apply discount percent\n   and pdt.AccountCode = 1 -- For a customer group\n   and pdt.ItemCode = 2    -- All items\n   and cast(getdate() as date) between pdt.FromDate \n                                   and case when pdt.ToDate = cast('1/1/1900' as datetime) then cast('1/1/2100' as datetime) else pdt.ToDate end\n\nselect CustVendRelation as [Account Number]\n      ,ItemId as [Item Id]\n      ,ExternalItemId as [External Item Id]\n  from CustVendExternalItem cvei\n\n\nselect AccountRelation, count(*) \n  from PriceDiscTable \n where AccountCode = 1 and DataAreaId = 'DUS'\ngroup by AccountRelation\n\nselect LineDisc, count(*) from CustTable group by LineDisc\nselect PriceGroup, count(*) from CustTable group by PriceGroup\n\nselect top 100 PriceGroup from CustTable where DataAreaId = 'Dca'\nselect top 100 * from PRICEDISCGROUP",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "dynamics365_financeandoperations_d365techdelivery_dev_sandbox",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}