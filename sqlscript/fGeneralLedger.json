{
	"name": "fGeneralLedger",
	"properties": {
		"folder": {
			"name": "VirtualDW"
		},
		"content": {
			"query": "use FnO\ngo\n\n-- Need to delete the storage in data lake\ndrop external table dw.fGeneralLedger\ngo\n\ncreate external table dw.fGeneralLedger with (\n    location = 'DataWarehouse/fGeneralLedger'\n   ,data_source = ParquetStorage\n   ,file_format = ParquetFormat\n) as \n    select\n        gje.AccountingDate as AccountingDate,\n        gje.DocumentDate as DocumentDate,\n        gje.DocumentNumber as DocumentNumber,\n        gje.JournalNumber as JournalNumber,\n        davc.DisplayValue as LedgerDimension,\n        gjae.MainAccount as MainAccount_FK,\n        davc.CostCenter as CostCenter_FK,\n        davc.Department as Department_FK,\n        davc.BusinessUnit as BusinessUnit_FK,\n        davc.ItemGroup as ItemGroup_FK,\n        l.Recid as LegalEntity_FK,\n        gjae.AccountingCurrencyAmount as [Amount(AccountingCurrency)],\n        l.AccountingCurrency as AccountingCurrency,\n        gjae.ReportingCurrencyAmount as [Amount(ReportingCurrency)],\n        l.ReportingCurrency as ReportingCurrency,\n        gjae.TransactionCurrencyAmount as [Amount(TransactionCurrency)],\n        gjae.TransactionCurrencyCode as TransactionCurrency,\n        gje.SubLedgerVoucher as SubLedgerVoucher\n   from raw.GeneralJournalAccountEntry gjae\n        join raw.GeneralJournalEntry gje on gjae.GeneralJournalEntry = gje.RecId\n        join raw.Ledger l on gje.Ledger = l.RecId\n        join raw.DimensionAttributeValueCombination davc on gjae.LedgerDimension = davc.RecId\ngo\n\nselect year(AccountingDate), count(*)\n  from dw.fGeneralLedger\n group by year(AccountingDate)\n order by 1\n\nselect d.MainAccount, d.Name, sum(f.[Amount(ReportingCurrency)]) as Total\n  from dw.fGeneralLedger f \n       inner join dw.dMainAccount d on f.MainAccount_FK = d.[Key]\n where d.ChartOfAccountName = 'Shared'\n group by d.MainAccount, d.Name\n order by 1",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "fno",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}